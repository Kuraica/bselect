!function(t){var e=function(e,s){this.defaultSettings={search:!0,width:"200px",defaultText:"Select me",className:"",inputName:"bselect-input",selected:0,opened:!1,multiple:!1,closeOnSelect:!0,elipsis:!0,focusDelay:100,doneTypingInterval:180},this.settings=t.extend(this.defaultSettings,s),this.element=e,this.selected=null,this.elipsis=this.settings.elipsis?"elipsis":"",this.searchInputValue="",this.jsonData=this.settings.data?this.settings.data:null,this.id=t(e).attr("id"),this.typingTimer=null,this.build()};e.prototype.build=function(){this.build_template(),this.bind_events()},e.prototype.build_template=function(){var e='<div class="bselect '+this.settings.className+'" id="'+this.id+'-bselect">';if(e+=null!=this.settings.input?this.settings.search:"<input type='hidden' name='"+this.settings.inputName+"' value='' class='bselect-input' />",e+="<div class='bselect-active "+(this.settings.multiple?"":"elipsis")+"'>"+this.wrapSelected(this.settings.defaultText)+"</div>",e+="<div class='bselect-content'>",this.settings.search&&(e+="<div class='bselect-search'><input type='text' name='s' placeholder='Search...' autocomplete='off'/></div>"),this.jsonData){for(var s in e+="<ul class='bselect-list'>",this.jsonData)e+=this.buildOption(s);e+="</ul>"}e+="</div>",e+="</div>";var i=t("#"+this.id);i.html(e),this.bselect=i.find(".bselect"),this.active=i.find(".bselect-active"),this.search=i.find(".bselect-search"),this.searchInput=this.search.find("input"),this.content=i.find(".bselect-content"),this.input=i.find(".bselect-input"),this.list=i.find(".bselect-list"),this.list_items=this.list.children(),this.bselect.css("width",this.settings.width);var n=t(this.bselect).width();t(this.content).css("width",n);var l=this;l.settings.selected&&(t.isArray(l.settings.selected)?(l.selected=l.settings.selected.join(","),t.each(l.settings.selected,function(t,e){l.selectById(e)})):(l.selected=this.settings.selected,l.selectById(this.settings.selected)))},e.prototype.wrapSelected=function(t){return"<div class='bselect-default-text'>"+t+"</div>"},e.prototype.buildOption=function(t){return"<li data-id='"+t+"' class='bselect-item "+this.elipsis+"'>"+this.jsonData[t]+"</li>"},e.prototype.promise=function(t){return new Promise(function(e,s){t?setTimeout(function(){e()},t):e()})},e.prototype.open=function(e){var s=this;s.element.trigger("open.bselect",{bselect:s.id,obj:s}),s.content.css("display","block"),s.settings.opened=!0,s.promise(s.settings.focusDelay).then(function(){s.searchInput.focus()}),t(document).on("click.bselect.document",function(t){jQuery.contains(s.element[0],t.target)||null==e||s.close()}),s.element.trigger("opened.bselect",{bselect:s.id,obj:s})},e.prototype.close=function(e){if(this.settings.opened){this.element.trigger("close.bselect",{bselect:this.id,obj:this}),this.content.css("display","none");var s=this;s.promise().then(function(){s.settings.opened=!1,s.searchInput.val(""),s.doneTyping(s,""),t(document).off("click.bselect.document")}),this.element.trigger("closed.bselect",{bselect:this.id,obj:this})}},e.prototype.toggle=function(t){this.element.trigger("toggle.bselect",{bselect:this.id,obj:this}),this.settings.opened?this.close(t):this.open(t),this.element.trigger("toggled.bselect",{bselect:this.id,obj:this})},e.prototype.prepend=function(t,e){this.add("prepend",t,e)},e.prototype.append=function(t,e){this.add("append",t,e)},e.prototype.add=function(t,e,s){if(null==this.jsonData[e]){this.jsonData[e]=s;var i=this.buildOption(e);"append"==t?this.list.append(i):this.list.prepend(i),this.list_items=this.list.children(),this.bindClick(),_self.element.trigger("updated.bselect",{bselect:_self.id,obj:_self})}},e.prototype.selectById=function(t,e){var s=this.find(t);null!=s&&this.select(s,e)},e.prototype.find=function(e){var s=null;return this.list_items.filter(function(){if(t(this).data("id")==e)return s=t(this),!1}),s},e.prototype.getSelected=function(){return this.selected},e.prototype.select=function(t,e){if(t.hasClass("bselect-disabled"))return!1;e||this.element.trigger("select.bselect",{bselect:this.id,element:t,obj:this}),this.selectElement(t),this.settings.closeOnSelect&&this.close(),e||this.element.trigger("selected.bselect",{bselect:this.id,element:t,obj:this})},e.prototype.selectElement=function(t){if(this.settings.multiple){null!=this.selected&&""!=this.selected||this.active.html("");var e=t.data("id");this.active.append(this.addItem(t)),this.appendSelectedValue(e),t.addClass("bselect-disabled")}else this.selected=t.data("id"),this.input.val(this.selected),this.active.html(this.wrapSelected(t.text()))},e.prototype.removeSelected=function(e){this.removeItem(t(e)),this.element.trigger("unseleced.bselect",{bselect:this.id,element:e,obj:this})},e.prototype.disable=function(t){var e=this.find(t);e&&e.addClass("bselect-disabled")},e.prototype.enable=function(t){var e=this.find(t);e&&e.removeClass("bselect-disabled")},e.prototype.addItem=function(t){return'<div class="bselect-multiple-item" id="bselect-multiple-'+t.data("id")+'" data-id="'+t.data("id")+'">'+t.text()+' <div class="bselect-remove" data-id="'+t.data("id")+'">X</div></div>'},e.prototype.removeItem=function(t){var e=t.data("id");this.removeSelectedValue(e),this.enable(e),t.parent().remove(),""!=this.selected&&null!=this.selected||this.active.html(this.wrapSelected(this.settings.defaultText))},e.prototype.removeSelectedValue=function(t){var e=this.input.val();e=e.split(","),e=this.removeA(e,t.toString()),this.selected=e.join(","),this.input.val(this.selected)},e.prototype.removeA=function(t){for(var e,s,i=arguments,n=i.length;n>1&&t.length;)for(e=i[--n];-1!==(s=t.indexOf(e));)t.splice(s,1);return t},e.prototype.appendSelectedValue=function(t){var e=this.input.val();(e=""!=e?e.split(","):[]).push(t),this.selected=e.join(","),this.input.val(this.selected)},e.prototype.doneTyping=function(e,s){""==s?e.list_items.css("display","block"):e.list_items.each(function(e,i){-1!==t(i).text().toLowerCase().indexOf(s.toLowerCase())?t(i).css("display","block"):t(i).css("display","none")})},e.prototype.bindClick=function(){var e=this;this.list.children().off("click.bselect.click").on("click.bselect.click",function(s){e.select(t(this))})},e.prototype.bind_events=function(){var e=this;t(this.active).on("mousedown.bselect.open",function(s){t(s.target).hasClass("bselect-remove")&&e.settings.multiple?e.removeSelected(s.target):e.toggle(s)}),this.bindClick(),t(this.searchInput).on("keyup",function(s){clearTimeout(e.typingTimer);var i=t(this).val();e.typingTimer=setTimeout(e.doneTyping,e.doneTypingInterval,e,i)}),t(this.searchInput).on("keydown",function(){clearTimeout(e.typingTimer)})},t.fn.bselect=function(){var s=arguments,i=s[0];if("string"==typeof i){var n=t(this).data("bselect"),l=Array.prototype.slice.call(s,1);return n[i].apply(n,l)}this.each(function(){var s=t(this),n=s.data("bselect"),l=t(this).attr("id");"object"==typeof i&&(s.data("bselect",n=new e(s,i)),null==window.bselect&&(window.bselect=[]),null==window.bselect[l]&&(window.bselect[l]=n))})}}(jQuery);
